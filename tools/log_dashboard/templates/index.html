<!--  
Copyright (C) 2024, 2025 P2Poolv2 Developers (see AUTHORS)

This file is part of P2Poolv2

P2Poolv2 is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option)
any later version.

P2Poolv2 is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with
P2Poolv2. If not, see <https://www.gnu.org/licenses/>. 
-->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü™µ Testing Hydrapool</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h2>Testing Hydrapool Stratum Server</h2>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="card">
          <p class="">Our goal is to validate Hydrapool Stratum Server with various hardware and firmware
            implementations of Stratum Client.</p>
          <p>All username used for testing will be <strong>included in our testers list on <a
                href="https://github.com/256-Foundation/Hydra-Pool/">Hydrapool github repo</a></strong>
            and will remain on this page. It is our way of saying thanks.</p>
          <p class="">Point your device to <strong><code>stratum+tcp://test.hydrapool.org:3000</code></strong>
          </p>
          <p class="">This dashboard is refreshed every minute, once your device status shows here, you can
            disconnect your device.
          </p>
          <p>Pointing your device to our test server for <strong>five minutes</strong> will give us enough
            information if we need to change our server to accommodate different hardware or firmware implementations .
          </p>
          <p>
            <strong>Note:</strong> This is a test server, do not use it for production mining. It is intended for
            testing purposes only. We are mining on our private bitcoin Signet.
          </p>
        </div>
      </div>
    </div>

    <!-- <div class="row">
      <div class="col-12">
        <form method="get" aria-label="Filter user agents">
          <input type="text" name="q" placeholder="Filter by user agent..." value="{{ query|default('') }}"
            autocomplete="off" />
          <button type="submit" aria-label="Filter logs">Filter</button>
          <a href="/" class="button-link" aria-label="Reset filter">Reset</a>
        </form>
      </div>
    </div> -->

    <div class="row">
      <div class="col-12">
        {% if agents %}
        <div class="card">
          <table role="table" aria-label="User Agent mining status table">
            <thead>
              <tr>
                <th scope="col">Status</th>
                <th scope="col">User Agent</th>
                <th scope="col">Submits</th>
                <th scope="col">Testers</th>
                <th scope="col">Last Logs</th>
              </tr>
            </thead>
            <tbody>
              {% for ua, info in agents.items() %}
              <tr>
                <td data-label="Status" title="{{ info.status }}">
                  {{ info.status }}
                </td>
                <td data-label="User Agent">{{ ua }}</td>
                <td data-label="Submits">{{ info.submits }}</td>
                <td data-label="Testers">
                  {% if info.usernames|length > 0 %}
                  <div class="username-list">
                    {% for username in info.usernames %}
                    <span class="username-badge" title="{{ username }}">{{ username[:24] + '...' if username|length > 16
                      else username }}</span>{% if not loop.last %}<br>{% endif %}
                    {% endfor %}
                  </div>
                  {% else %}
                  <span class="text-muted">None</span>
                  {% endif %}
                </td>
                <td data-label="Last Session Log">
                  <a href="{{ url_for('download_last_session_log', ua=ua) }}" class="btn btn-success"
                    title="Download Last Session Log">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      viewBox="0 0 16 16" aria-hidden="true">
                      <path
                        d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                      <path
                        d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                    </svg>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="card">
          <p class="text-center text-warning" style="font-weight:600;">‚ö†Ô∏è No user agents found. Check logs.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div id="instructions">
          <div>
            <span class="text-success">
              üü¢ PASS</span> miner has successfully submitted blocks
          </div>
          <div>
            <span style="color:#daa038;">üü° PENDING SUBMITS</span> waiting for successful block submissions
          </div>
          <div>
            <span style="color:#9c2929;">üî¥ FAILED</span> block submission failed
          </div>
          <div>
            <span style="color:#e2c389;">üîµ DISCONNECTED</span> device disconnected without submitting shares
          </div>
        </div>
      </div>

      <!-- Usernames Modal -->
      <div id="usernamesModal"
        style="display:none; position: fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; max-width:500px; z-index:1000; max-height:80vh; overflow-y:auto;">
        <h3>Usernames for <span id="modalUserAgent"></span></h3>
        <ul id="usernamesList"></ul>
        <button id="closeUsernamesModal">Close</button>
      </div>

      <script>
        document.getElementById('closeUsernamesModal').addEventListener('click', () => {
          document.getElementById('usernamesModal').style.display = 'none';
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
          const modal = document.getElementById('usernamesModal');
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });

        // Handle responsive behavior for tables
        function handleResponsiveTable() {
          const width = window.innerWidth;
          const tables = document.querySelectorAll('table');

          if (width < 992) {
            tables.forEach(table => {
              table.classList.add('responsive');
            });
          } else {
            tables.forEach(table => {
              table.classList.remove('responsive');
            });
          }
        }

        // Run on page load and on resize
        handleResponsiveTable();
        window.addEventListener('resize', handleResponsiveTable);
      </script>

</body>

</html>